<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Christmas Postcard Creator üéÑ</title>
  <meta name="description" content="Generate a beautiful watercolor Christmas postcard with AI. Add a recipient's name, a wish, and a personal message." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main class="wrap">
    <header class="header">
      <div class="brand">
        <h1>Christmas Postcard Creator üéÑ</h1>
      </div>

      <p class="subtitle">
        Generate a beautiful watercolor Christmas postcard with the <b>recipient's name</b>, a <b>wish</b>, and a <b>personal message</b>.
      </p>

      <div class="badge-row" aria-hidden="true">
        <span class="badge">Watercolor + Gouache</span>
        <span class="badge">Printed Postcard Feel</span>
        <span class="badge">Legible Typography</span>
      </div>
    </header>

    <section class="card">
      <form id="form" class="form">
        <label>
          <span>Recipient Name</span>
          <input id="name" name="name" type="text" placeholder="Alex" maxlength="60" required />
          <div class="hint">The name that will appear on the postcard greeting.</div>
        </label>

        <label>
          <span>Wish</span>
          <input id="wish" name="wish" type="text" placeholder="a British green Aston Martin" maxlength="180" required />
          <div class="hint">This will be depicted visually on the right side as the "gift made real".</div>
        </label>

        <label>
          <span>Message</span>
          <input id="message" name="message" type="text" placeholder="Merry Christmas from your favorite uncle üòÑ" maxlength="120" required />
          <div class="hint">A small extra line, bottom-left inside the cream border.</div>
        </label>

        <div class="row">
          <button id="generate" type="submit">Generate Postcard</button>
          <button id="rand" type="button" class="secondary">Random Example</button>
          <button id="downloadBtn" type="button" class="secondary" disabled>Download</button>
        </div>

        <p id="status" class="status" aria-live="polite"></p>
      </form>

      <div class="preview">
        <div class="imgbox">
          <img id="img" src="" alt="Your generated postcard will appear here" />
        </div>
        <div class="meta">
          <span id="seed"></span>
          <a id="download" class="link" download="christmas-postcard.jpg" href="#" style="display:none;">Download Image</a>
        </div>
      </div>
    </section>

    <footer class="footer">
      <small>Powered by Pollinations AI ‚Ä¢ Made with ‚ù§Ô∏è for the holidays</small>
    </footer>
  </main>

  <script src="app.js"></script>

  <script>
    // Random examples functionality
    (function () {
      const randBtn = document.getElementById('rand');
      const nameEl = document.getElementById('name');
      const wishEl = document.getElementById('wish');
      const msgEl  = document.getElementById('message');
      const imgEl  = document.getElementById('img');
      const dlBtn  = document.getElementById('downloadBtn');
      const dlLink = document.getElementById('download');

      const names = ["Alex", "Maria", "Daniel", "Sofia", "Chris", "Noah", "Emma", "Leo", "Nina", "Sam"];
      const wishes = [
        "a cozy cabin in a snowy forest with warm amber lights",
        "a British green Aston Martin parked beside the tree",
        "a golden ticket to a dream trip to Japan",
        "a beautiful grand piano with sheet music and candlelight",
        "a stack of finished novels with a fountain pen",
        "a rescue dog with a red scarf and a tiny gift box",
        "a vintage telescope aimed at a starry winter sky",
        "a small sailboat on calm moonlit water (as a miniature gift)",
        "a painter's easel with a half-finished winter landscape",
        "a pair of elegant headphones with shimmering bokeh lights"
      ];
      const messages = [
        "Merry Christmas from your favorite uncle üòÑ",
        "Wishing you a joyful holiday season!",
        "Hope you love it ‚Äî Merry Christmas!",
        "Warm wishes and big smiles ‚ú®",
        "May your Christmas be bright and calm.",
        "Enjoy your gift!",
        "Sending you good vibes üéÑ",
        "Merry Christmas ‚Äî all the best!",
        "A little magic for you ‚ú®",
        "Wishing you peace and joy."
      ];

      randBtn.addEventListener('click', () => {
        nameEl.value = names[Math.floor(Math.random() * names.length)];
        wishEl.value = wishes[Math.floor(Math.random() * wishes.length)];
        msgEl.value  = messages[Math.floor(Math.random() * messages.length)];
        document.getElementById('form').requestSubmit();
      });

      function enableDownloadUI(){
        const ok = !!imgEl.src && imgEl.src !== window.location.href && imgEl.src !== '';
        dlBtn.disabled = !ok;
        dlLink.style.display = ok ? "inline" : "none";
        if (ok) dlLink.href = imgEl.src;
      }

      imgEl.addEventListener('load', enableDownloadUI);

      dlBtn.addEventListener('click', async () => {
        if (!imgEl.src) return;

        // Try "real download" via Blob. If CORS blocks it, fallback to opening the image.
        try{
          const res = await fetch(imgEl.src, { mode: "cors" });
          if (!res.ok) throw new Error("download failed");

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);

          const a = document.createElement('a');
          a.href = url;
          a.download = "christmas-postcard.jpg";
          document.body.appendChild(a);
          a.click();
          a.remove();

          setTimeout(() => URL.revokeObjectURL(url), 1000);
        }catch(e){
          window.open(imgEl.src, "_blank", "noopener,noreferrer");
        }
      });

      // Initial state
      enableDownloadUI();
    })();
  </script>
</body>
</html>
